<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3 Marias Loja</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #fdf7f9;
            color: #333;
        }

        header {
            background-color: #d8a0b0;
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            cursor: pointer; 
        }

        header h1 {
            margin: 0;
            font-size: 2.5em; 
        }
        
        header p {
            font-size: 1.1em;
        }

        main {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 15px;
        }
        
        /* Controles de Filtro com Bot√µes */
        #controls {
            display: flex;
            flex-direction: column; 
            gap: 15px; 
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            align-items: center; 
        }

        /* Estilo para os bot√µes de filtro */
        .filter-button {
            background-color: #d8a0b0; 
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            border: 2px solid #FFD700; 
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s, transform 0.2s;
            width: 100%; 
            max-width: 350px; 
            text-align: center;
            box-sizing: border-box; 
        }

        .filter-button:hover {
            background-color: #c08090; 
            border-color: #DAA520; 
            transform: translateY(-2px);
        }

        /* Estilo para o bot√£o ativo (selecionado) */
        .filter-button.active {
            background-color: #b76e86; 
            border-color: #DAA520; 
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); 
        }

        /* M√≠dia query para telas maiores: colocar bot√µes lado a lado */
        @media (min-width: 600px) {
            #controls {
                flex-direction: row; 
                justify-content: center;
            }
            .filter-button {
                width: auto; 
                margin: 0 10px; 
            }
        }


        /* √Årea dos Produtos */
        #products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .product-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            text-decoration: none;
            color: #333;
            transition: transform 0.2s;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .product-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .product-info {
            padding: 15px;
            flex-grow: 1;
        }

        .product-info h2 {
            margin-top: 0;
            font-size: 1.2em;
            color: #b76e86;
            min-height: 40px;
        }

        .product-info .price {
            font-size: 1.4em;
            font-weight: bold;
            margin: 10px 0 0;
        }
        
        /* Bot√£o Ver Detalhes */
        .details-button {
            display: block;
            background-color: #b76e86; 
            color: white;
            text-decoration: none;
            text-align: center;
            padding: 12px;
            margin: 15px; 
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .details-button:hover {
            background-color: #8c4c61;
        }

        /* Cont√™iner dos Selos para posicionamento */
        .badge-container {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex; /* Permite colocar os selos lado a lado */
            gap: 8px; /* Espa√ßo entre os selos */
            z-index: 10;
        }

        /* Estilos dos Selos */
        .status-badge {
            font-size: 0.8em;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            white-space: nowrap; /* N√£o quebra a linha */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Estilos dos Selos de Disponibilidade */
        .status-pronta-entrega { 
            background-color: #d4edda; 
            color: #0c611f; 
        }
        .status-sob-encomenda { 
            background-color: #fce8a9; 
            color: #856404; 
        }

        /* NOVO: Estilos dos Selos de Destaque */
        .badge-new { 
            background-color: #ff5722; /* Laranja/Vermelho para Novo */
            color: white; 
        }
        .badge-featured { 
            background-color: #FFD700; /* Dourado para Destaque */
            color: #333; 
        }

        /* Rodap√© */
        footer {
            text-align: center;
            padding: 1rem;
            background-color: #e0e0e0;
            color: #777;
            margin-top: 2rem;
        }
    </style>
</head>
<body>

    <header id="admin-secret-trigger">
        <h1>3 MARIAS MODA FEMININA</h1>
        <p>Lingeries e muito mais direto do Brasil!<br> Tudo √† pronta-entrega.</p>
    </header>

    <main>
        <div id="controls">
            <button class="filter-button active" data-filter="pronta-entrega">
                Toyohashi e Regi√£o (Pronta Entrega)
            </button>
            <button class="filter-button" data-filter="sob-encomenda">
                Receba em 3-5 dias. Qualquer lugar do Jap√£o (Sob Encomenda)
            </button>
        </div>
        
        <div id="loading">Carregando produtos...</div>
        <div id="empty-message" style="display: none;">Nenhum produto encontrado com o filtro selecionado.</div>

        <div id="products-grid">
            </div>
    </main>

    <footer>
        <p>¬© 2025 Sua Loja. Todos os direitos reservados.</p>
        </footer>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDtQK3dZKTqoTkXkwTUM2vkviVD41UoHpI",
            authDomain: "loja3marias-50204.firebaseapp.com",
            projectId: "loja3marias-50204",
            storageBucket: "loja3marias-50204.firebasestorage.app",
            messagingSenderId: "405330133487",
            appId: "1:405330133487:web:606de41211df52245f761a",
            measurementId: "G-TK877V6P0S"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(); 

        const productsGrid = document.getElementById('products-grid');
        const loadingDiv = document.getElementById('loading');
        const emptyMessageDiv = document.getElementById('empty-message');
        const filterButtons = document.querySelectorAll('.filter-button');
        const adminSecretTrigger = document.getElementById('admin-secret-trigger');
        
        const WHATSAPP_NUMBER = "818074558624";

        let currentFilter = 'pronta-entrega'; 

        // --- L√ìGICA DO ACESSO ADMIN SECRETO (TRIPLE CLICK) ---
        let clickCount = 0;
        let lastClickTime = 0;
        const TRIPLE_CLICK_INTERVAL = 500; 

        adminSecretTrigger.addEventListener('click', () => {
            const now = new Date().getTime();

            if (now - lastClickTime > TRIPLE_CLICK_INTERVAL) {
                clickCount = 1; 
            } else {
                clickCount++;
            }

            lastClickTime = now;

            if (clickCount === 3) {
                clickCount = 0; 
                window.location.href = 'admin.html'; 
            }
        });
        // --------------------------------------------------------

        // L√ìGICA DE BUSCA (ATUALIZADA)
        async function fetchProducts() {
            productsGrid.innerHTML = '';
            loadingDiv.style.display = 'block';
            emptyMessageDiv.style.display = 'none';

            try {
                let query = db.collection("products");
                
                // Aplica o filtro
                if (currentFilter !== 'todos') {
                    query = query.where("source", "==", currentFilter);
                }
                
                // Ordem: Destaque primeiro, depois os mais novos
                query = query.orderBy("isFeatured", "desc").orderBy("createdAt", "desc");
                
                const snapshot = await query.get();
                const products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                loadingDiv.style.display = 'none';

                if (products.length === 0) {
                    emptyMessageDiv.style.display = 'block';
                    return;
                }

                products.forEach(product => {
                    const name = product.name || 'Produto Sem Nome';
                    const imageUrl = product.imageUrl || 'https://via.placeholder.com/300x200?text=IMAGEM';
                    const price = product.price || '0';
                    const source = product.source || 'pronta-entrega'; 
                    
                    const priceValue = parseFloat(price.toString().replace(',', '.')); 
                    const precoFormatado = priceValue.toLocaleString('ja-JP', { 
                        style: 'currency', 
                        currency: 'JPY',
                        maximumFractionDigits: 0
                    });

                    let statusText = '';
                    let statusClass = '';

                    if (source === 'pronta-entrega') {
                        statusText = 'Pronta Entrega';
                        statusClass = 'status-pronta-entrega';
                    } else if (source === 'sob-encomenda') {
                        statusText = 'Sob Encomenda';
                        statusClass = 'status-sob-encomenda';
                    }

                    // NOVO: Gera√ß√£o dos Selos Extras
                    let extraBadges = '';
                    if (product.isFeatured) {
                        extraBadges += `<span class="status-badge badge-featured">üî• DESTAQUE</span>`;
                    }
                    // Adiciona o selo de novo APENAS se n√£o for destaque para n√£o poluir, ou voc√™ pode alterar a ordem
                    if (product.isNew && !product.isFeatured) {
                        extraBadges += `<span class="status-badge badge-new">‚ú® NOVIDADE</span>`;
                    }
                    
                    // Juntando todos os selos
                    const allBadges = `
                        <div class="badge-container">
                            ${extraBadges}
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                    `;


                    const card = `
                        <div class="product-card">
                            ${allBadges} 
                            
                            <a href="detalhes.html?id=${product.id}" class="product-link-block">
                                <img src="${imageUrl}" alt="${name}">
                                <div class="product-info">
                                    <h2>${name}</h2>
                                    <p class="price">${precoFormatado}</p>
                                </div>
                            </a>
                            <a href="detalhes.html?id=${product.id}" class="details-button">
                                Ver Detalhes
                            </a>
                        </div>
                    `;
                    productsGrid.innerHTML += card;
                });

            } catch (error) {
                console.error("Erro ao carregar produtos:", error);
                loadingDiv.style.display = 'none';
                productsGrid.innerHTML = `<p style="color: red; grid-column: 1 / -1;">Erro ao carregar dados. Verifique a conex√£o com o Firebase: ${error.message}</p>`;
            }
        }

        // Adiciona evento de clique aos bot√µes de filtro (mantido)
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                currentFilter = button.dataset.filter;
                fetchProducts();
            });
        });

        // Inicializa o filtro e o estado ativo (mantido)
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector('[data-filter="pronta-entrega"]').classList.add('active');
            fetchProducts();
        });
    </script>
</body>
</html>
